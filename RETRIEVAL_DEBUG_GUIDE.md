# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞

## –ü—Ä–æ–±–ª–µ–º–∞
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å —Ä–µ—Ç—Ä–∏–≤–µ—Ä–æ–º –∏ –±–µ–∑ –Ω–µ–≥–æ. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç
2. –†–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ª–∏ –ø—Ä–æ–º–ø—Ç—ã –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
3. –ù–µ—Ç –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏

## –°–∫—Ä–∏–ø—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. `check_retrieval_debug.py` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –í–∫–ª—é—á–µ–Ω –ª–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è `retrieve_relevant()`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç
- –†–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ª–∏ –ø—Ä–æ–º–ø—Ç—ã –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π hard/expert —Å—Ü–µ–Ω–∞—Ä–∏–π
python check_retrieval_debug.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
python check_retrieval_debug.py <scenario_id>
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ `data/output/scenarios/`
2. –°–æ–∑–¥–∞–µ—Ç –¥–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥–∞ (—Å —Ä–µ—Ç—Ä–∏–≤–µ—Ä–æ–º –∏ –±–µ–∑)
3. –í—ã–∑—ã–≤–∞–µ—Ç `retrieve_relevant()` –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–∏—è

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –° —Ä–µ—Ç—Ä–∏–≤–µ—Ä–æ–º: –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–º–µ–Ω—å—à–µ –ø–æ–ª–Ω–æ–≥–æ)
- –ë–µ–∑ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞: –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è `None` –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
- –ü—Ä–æ–º–ø—Ç—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è

### 2. `check_caching.py` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ï—Å—Ç—å –ª–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- –ï—Å—Ç—å –ª–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ê–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
python check_caching.py evaluation_results/with_retrieval_*/evaluation_results.json

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
python check_caching.py \
    evaluation_results/with_retrieval_*/evaluation_results.json \
    evaluation_results/without_retrieval_*/evaluation_results.json
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
1. –ò—â–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–æ–º–ø—Ç–æ–≤ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
2. –ò—â–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã)
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–∞ —Ñ–∞–π–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞–ª–æ –∏–ª–∏ –Ω–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –ï—Å–ª–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å >50% - –≤–æ–∑–º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞
```bash
python check_retrieval_debug.py
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- ‚úÖ "Retrieval SUCCESS" - —Ä–µ—Ç—Ä–∏–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ "Retrieved context length: X chars" - —Ä–µ—Ç—Ä–∏–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç
- ‚úÖ "Prompts ARE different" - –ø—Ä–æ–º–ø—Ç—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**
- ‚ùå "Retrieval returned EMPTY result" - —Ä–µ—Ç—Ä–∏–≤–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è "Prompts are similar" - —Ä–µ—Ç—Ä–∏–≤–µ—Ä –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–º–ø—Ç

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ü–µ–Ω–∫–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `run_evaluation_comparison.py`:

```bash
# –ù–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
ls -t evaluation_results/with_retrieval_*/evaluation_results.json | head -1
ls -t evaluation_results/without_retrieval_*/evaluation_results.json | head -1

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
python check_caching.py \
    $(ls -t evaluation_results/with_retrieval_*/evaluation_results.json | head -1) \
    $(ls -t evaluation_results/without_retrieval_*/evaluation_results.json | head -1)
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- ‚úÖ "Different responses: X" - –æ—Ç–≤–µ—Ç—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è
- ‚ö†Ô∏è "Response similarity: >50%" - –≤–æ–∑–º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `run_evaluation_comparison.py` —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:

**–° —Ä–µ—Ç—Ä–∏–≤–µ—Ä–æ–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:**
```
üîç Applying retrieval for hard scenario: <id>
üìÅ Using project directory for retrieval: <path>
‚úÖ Retrieval produced context of X characters for scenario <id>
```

**–ë–µ–∑ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üîç Applying retrieval...
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Ä–µ—Ç—Ä–∏–≤–µ—Ä –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –†–µ—Ç—Ä–∏–≤–µ—Ä –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π "üîç Applying retrieval"
- `check_retrieval_debug.py` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Retrieval will NOT be applied"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `config['retrieval']['enabled']` –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ difficulty —Å—Ü–µ–Ω–∞—Ä–∏—è –≤ `config['retrieval']['difficulties']`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –†–µ—Ç—Ä–∏–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
**–°–∏–º–ø—Ç–æ–º—ã:**
- "‚ö†Ô∏è Retrieval returned empty result"
- –ü—Ä–æ–º–ø—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `project_dir` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `context_files` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- –í—ã—Å–æ–∫–∞—è similarity –º–µ–∂–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API (–Ω–µ—Ç –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞)
- –î–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç (timestamp, random seed)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –†–µ—Ç—Ä–∏–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–µ—Ç—Ä–∏–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–æ–º–ø—Ç—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è
- –ù–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –í–æ–∑–º–æ–∂–Ω–æ, –º–æ–¥–µ–ª—å –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç retrieved context
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ retrieved context –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä retrieved context
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ retrieved context (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞

–í `config.yaml` –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–º –∫–æ–Ω—Ñ–∏–≥–µ –¥–æ–±–∞–≤—å—Ç–µ:
```yaml
logging:
  level: DEBUG
```

–ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export LOGLEVEL=DEBUG
python run_evaluation_comparison.py
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –≤—Ä—É—á–Ω—É—é

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ü–µ–Ω–∫–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–º–ø—Ç—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö:
```bash
# –ò–∑–≤–ª–µ—á—å –ø—Ä–æ–º–ø—Ç—ã –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
python -c "
import json
with open('evaluation_results/with_retrieval_*/evaluation_results.json') as f:
    data = json.load(f)
    for model, scenarios in data.get('results', {}).items():
        for s in scenarios[:1]:  # –ü–µ—Ä–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
            print('PROMPT:')
            print(s.get('prompt', '')[:1000])
            print('\n---\n')
"
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–µ—Ç—Ä–∏–≤–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

–î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π print –≤ `evaluator.py` –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 2489:
```python
print(f"DEBUG: Using retrieved context: {len(retrieved_context)} chars")
print(f"DEBUG: Context section preview: {context_section[:500]}")
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ retrieved context –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—Ä–æ–º–ø—Ç.
