# Анализ максимального скора 2.115

## Проблема
После изменений скор упал с **2.115** до **1.991** (-0.124). Нужно понять, что давало максимальный скор и почему текущая версия хуже.

## Версия с максимальным скором (f1922da)

### Параметры для Architectural Understanding:
- **file_multiplier**: 1.60 (умеренное увеличение)
- **level1_ratio**: 0.50 (50% семантически релевантных файлов)
- **level2_ratio**: 0.40 (40% зависимостей)
- **level3_ratio**: 0.10 (10% важных файлов)

### Параметры для Code Comprehension:
- **file_multiplier**: 1.25 (умеренное увеличение)
- **level1_ratio**: 0.60 (60% семантически релевантных файлов)
- **level2_ratio**: 0.35 (35% зависимостей)
- **level3_ratio**: 0.05 (5% важных файлов)

## Текущая версия (HEAD)

### Параметры для Architectural Understanding:
- **file_multiplier**: 2.40 (слишком большое увеличение!)
- **level1_ratio**: 0.38 (38% семантики - **меньше чем было**)
- **level2_ratio**: 0.52 (52% зависимостей - **больше чем было**)
- **level3_ratio**: 0.10 (10% важных файлов)
- **Дополнительный буст**: +10% (строка 1408)

### Параметры для Code Comprehension:
- **file_multiplier**: 2.10 (слишком большое увеличение!)
- **level1_ratio**: 0.48 (48% семантики - **меньше чем было**)
- **level2_ratio**: 0.47 (47% зависимостей - **больше чем было**)
- **level3_ratio**: 0.05 (5% важных файлов)
- **Дополнительный буст**: +8% (строка 1412)

## Ключевые проблемы текущей версии

### 1. **Слишком большой file_multiplier**
- Architectural: 1.60 → 2.40 (+50% от оптимального)
- Comprehension: 1.25 → 2.10 (+68% от оптимального)
- **Проблема**: Больше файлов ≠ лучше качество. Избыток файлов может добавить шум и снизить релевантность.

### 2. **Смещение баланса в сторону зависимостей**
- Architectural: level1_ratio 0.50 → 0.38 (-24%), level2_ratio 0.40 → 0.52 (+30%)
- Comprehension: level1_ratio 0.60 → 0.48 (-20%), level2_ratio 0.35 → 0.47 (+34%)
- **Проблема**: Семантический поиск (level1) более точен для этих категорий задач. Увеличение доли зависимостей (level2) может добавить менее релевантные файлы.

### 3. **Дополнительные бусты усугубляют проблему**
- Architectural: +10% дополнительных файлов поверх уже увеличенного multiplier
- Comprehension: +8% дополнительных файлов поверх уже увеличенного multiplier
- **Проблема**: Это еще больше увеличивает количество файлов без улучшения качества.

## Почему версия f1922da работала лучше

1. **Сбалансированный подход**: Умеренные multipliers (1.60 и 1.25) не перегружали контекст
2. **Больше семантики**: Высокий level1_ratio (50-60%) обеспечивал более точный поиск релевантных файлов
3. **Оптимальный баланс зависимостей**: level2_ratio (35-40%) давал достаточно контекста без шума
4. **Простота**: Прямые параметры без сложной системы категорий и дополнительных бустов

## Рекомендации для восстановления скора 2.115+

### Вернуть параметры из f1922da:

**Architectural Understanding:**
```python
'file_multiplier': 1.60,  # Вернуть с 2.40
'level1_ratio': 0.50,     # Вернуть с 0.38
'level2_ratio': 0.40,     # Вернуть с 0.52
'level3_ratio': 0.10,     # Оставить как есть
```

**Code Comprehension:**
```python
'file_multiplier': 1.25,  # Вернуть с 2.10
'level1_ratio': 0.60,     # Вернуть с 0.48
'level2_ratio': 0.35,     # Вернуть с 0.47
'level3_ratio': 0.05,     # Оставить как есть
```

### Убрать дополнительные бусты:
- Удалить строки 1404-1414 (дополнительные 10% и 8% бусты)

### Альтернативный подход (если нужно улучшить дальше):
Вместо увеличения количества файлов, улучшить качество семантического поиска:
- Улучшить query expansion
- Настроить hybrid_alpha для лучшего баланса
- Оптимизировать multi-query retrieval

## Вывод

**Максимальный скор 2.115 был достигнут благодаря:**
1. Умеренным multipliers (1.60 и 1.25)
2. Высокому уровню семантического поиска (level1_ratio 50-60%)
3. Сбалансированному количеству зависимостей (level2_ratio 35-40%)
4. Простоте без избыточных оптимизаций

**Текущая версия хуже из-за:**
1. Избыточного количества файлов (multipliers 2.40 и 2.10 + дополнительные бусты)
2. Смещения баланса в сторону зависимостей вместо семантики
3. Переоптимизации, которая добавила шум вместо улучшения качества

**Решение**: Вернуть параметры из коммита f1922da для architectural_understanding и code_comprehension категорий.
